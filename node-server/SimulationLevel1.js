var express = require('express');
var io = require('socket.io');
var app = express();               
var server = app.listen(8080);
var socketServer = io(server);     

socketServer.on('connection', openSocket);

var messages = [
    '110001100101111101100100100011101110',
    '000001100101111101100100100011101110',
    '011001100101111101100100100011101110',
    '011001100101011101100100100011101110',
    '011001000101011101000100100011101110',
    '111001000101011101000100100011101110',
    '111001100101111101000100100011101110',
    '111001100101111101100100100011001110',
    '111001100101111101100100100011011100',
    '111001100101111101100100100011111000',
    '111000100101111101100101100011111000',
    '111000100101111101100101100110111000',
    '111000100101111101100101101100111000',
    '111000100101111101100101111000111000',
    '111000100001111101100101111100111000',
    '111000100001111001100101111100111100',
    '111000100001101101100101111100111100',
    '111000100001100111100101111100111100',
    '111000100000100111100101111101111100',
    '111000100000100110100101111101111101',
    '111000100000100011100101111101111101',
    '111000100000100001100101111101111101',
    '111000100000100000100101111101111101'
];

function openSocket(socket){
    console.log('new user address: ' + socket.handshake.address);
    var i = 0;
    var tick = function() {
	socket.emit('message', messages[i++]);
	if (i < messages.length) {
	    setTimeout(tick, 500);
	}
    }
    tick();
}
